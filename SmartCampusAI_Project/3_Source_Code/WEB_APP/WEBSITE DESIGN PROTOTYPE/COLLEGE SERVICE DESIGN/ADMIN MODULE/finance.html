<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusG Finance Management</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Custom font and base styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate 100 background for app feel */
            min-height: 100vh;
        }
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #10b981;
        }

        /* Ensure main content scales responsively with sidebar */
        @media (min-width: 1024px) {
            .main-content-area {
                margin-left: 16rem; /* Tailwind 'w-64' for sidebar */
            }
        }
        
        /* Simple Chart Placeholder Styling (SVG) */
        .chart-placeholder {
            width: 100%;
            height: 180px;
            background-color: #e0e7ff; /* light indigo */
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#4f46e5', /* Indigo 600 */
                        'primary-dark': '#4338ca', /* Indigo 700 */
                        'secondary': '#10b981', /* Emerald 500 */
                    }
                }
            }
        }
    </script>
</head>
<body class="text-gray-800">

    <!-- Sidebar (Fixed on Desktop, Hidden on Mobile) -->
    <aside id="sidebar" class="fixed top-0 left-0 z-40 w-64 h-full bg-gray-900 text-white shadow-2xl lg:translate-x-0 transition-transform duration-300 transform -translate-x-full">
        <div class="p-6 h-full flex flex-col">
            
            <!-- Logo/App Title -->
            <div class="flex items-center space-x-2 pb-6 mb-6 border-b border-gray-700">
                <svg class="h-8 w-8 text-primary" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor" opacity="0.1"/>
                    <path d="M22 7V17L12 22L2 17V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 12V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M7 9L12 12L17 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="text-2xl font-bold">CampusG</span>
            </div>

            <!-- Navigation Links -->
            <nav class="flex-grow space-y-2">
                <a href="dashboard.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-primary transition duration-150">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span>Dashboard</span>
                </a>
                
                <a href="academics.html" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-primary transition duration-150">
                    <i data-lucide="book-open" class="w-5 h-5"></i>
                    <span>Academics</span>
                </a>
                
                <a href="#" class="flex items-center space-x-3 p-3 rounded-lg bg-primary text-white font-semibold shadow-lg">
                    <i data-lucide="dollar-sign" class="w-5 h-5"></i>
                    <span>Finance</span>
                </a>

                <a href="#hr-staff" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-primary transition duration-150">
                    <i data-lucide="briefcase" class="w-5 h-5"></i>
                    <span>HR & Staff</span>
                </a>
                
                <a href="#campus-life" class="flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-primary transition duration-150">
                    <i data-lucide="calendar" class="w-5 h-5"></i>
                    <span>Campus Life</span>
                </a>
            </nav>

            <!-- Sign Out Button -->
            <button id="signout-button" class="w-full mt-8 flex items-center justify-center space-x-2 p-3 border border-gray-700 text-gray-300 rounded-lg hover:bg-red-700 hover:text-white transition duration-200">
                <i data-lucide="log-out" class="w-5 h-5"></i>
                <span>Sign Out</span>
            </button>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div id="main-content" class="main-content-area transition-all duration-300 p-4 lg:p-8">
        
        <!-- Top Nav/Header for Mobile and Desktop -->
        <header class="flex items-center justify-between p-4 bg-white rounded-xl shadow-md mb-8">
            <h1 class="text-3xl font-extrabold text-gray-900 flex items-center">
                <i data-lucide="dollar-sign" class="w-7 h-7 text-primary mr-3 hidden md:block"></i>
                Finance Management
            </h1>
            
            <div class="flex items-center space-x-4">
                <!-- Mobile Menu Toggle Button (Visible on Mobile Only) -->
                <button id="mobile-sidebar-toggle" class="lg:hidden p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                
                <button class="p-2 rounded-full text-gray-600 hover:bg-gray-100 relative">
                    <i data-lucide="bell" class="w-6 h-6"></i>
                    <span class="absolute top-0 right-0 h-3 w-3 bg-red-500 rounded-full border-2 border-white"></span>
                </button>
                
                <div class="relative group">
                    <button class="flex items-center space-x-2 p-1 rounded-full bg-gray-100 hover:bg-gray-200 transition">
                        <img src="https://placehold.co/40x40/4f46e5/ffffff?text=A" alt="User Avatar" class="w-10 h-10 rounded-full border-2 border-primary">
                        <i data-lucide="chevron-down" class="w-4 h-4 text-gray-600"></i>
                    </button>
                    <!-- Mock Profile Dropdown -->
                    <div class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition duration-300 z-50">
                        <div class="flex flex-col p-2">
                            <p class="text-sm font-semibold px-3 py-1 text-gray-900 border-b mb-1">Admin User</p>
                            <button id="profile-signout-button" class="w-full text-left text-red-500 hover:bg-red-50 px-3 py-2 rounded-lg transition duration-150">Sign Out</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dynamic Content Area -->
        <div class="space-y-8">
            
            <!-- Filter Controls (Consistent with Academics Page) -->
            <section id="filter-controls" class="bg-white p-6 rounded-xl shadow-lg flex flex-col md:flex-row gap-4 items-center">
                <h2 class="text-xl font-bold text-gray-900 flex-shrink-0">Filter Financial Data:</h2>
                
                <!-- Filter 1: Academic Year -->
                <div class="w-full md:w-auto">
                    <label for="filter-year" class="block text-xs font-medium text-gray-500 mb-1">Academic Year</label>
                    <select id="filter-year" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-primary focus:border-primary transition">
                        <option value="2024">2024 - 2025 (Current)</option>
                        <option value="2023">2023 - 2024</option>
                        <option value="2022">2022 - 2023</option>
                    </select>
                </div>
                
                <!-- Filter 2: Branch/Department -->
                <div class="w-full md:w-auto md:flex-grow">
                    <label for="filter-branch" class="block text-xs font-medium text-gray-500 mb-1">Branch/Department</label>
                    <select id="filter-branch" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-primary focus:border-primary transition">
                        <option value="all">All Branches</option>
                        <option value="cs">Computer Science & Engineering</option>
                        <option value="mba">Business Administration (MBA)</option>
                        <option value="arts">Arts & Humanities</option>
                        <option value="mech">Mechanical Engineering</option>
                    </select>
                </div>
                
                <!-- Filter 3: Fee Type -->
                <div class="w-full md:w-auto">
                    <label for="filter-fee-type" class="block text-xs font-medium text-gray-500 mb-1">Fee Type</label>
                    <select id="filter-fee-type" class="w-full border border-gray-300 rounded-lg p-2 focus:ring-primary focus:border-primary transition">
                        <option value="all">All Fees</option>
                        <option value="tuition">Tuition Only</option>
                        <option value="hostel">Hostel Fees</option>
                        <option value="exam">Exam Fees</option>
                    </select>
                </div>
                
                <button onclick="applyFinanceFilters()" class="w-full md:w-auto bg-primary text-white py-2 px-4 rounded-lg font-medium hover:bg-primary-dark transition duration-150 mt-auto md:mt-0">
                    Apply Filters
                </button>
            </section>

            <!-- 1. Key Financial KPIs -->
            <section id="finance-kpis">
                <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    
                    <!-- KPI Card 1: Total Revenue Collected (Paid) -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-b-4 border-secondary transition duration-300 hover:shadow-xl hover:translate-y-[-2px]">
                        <div class="flex items-center justify-between">
                            <i data-lucide="check-circle" class="w-8 h-8 text-secondary"></i>
                            <span class="text-xs font-semibold text-secondary uppercase">Revenue Collected YTD</span>
                        </div>
                        <p id="kpi-collected" class="text-4xl font-extrabold text-gray-900 mt-3">$4,850,000</p>
                        <p class="text-sm text-gray-500 mt-1 flex items-center">
                            <i data-lucide="arrow-up" class="w-4 h-4 text-secondary mr-1"></i> 
                            85% of Total Target
                        </p>
                    </div>

                    <!-- KPI Card 2: Total Outstanding Fees (Unpaid) -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-b-4 border-primary transition duration-300 hover:shadow-xl hover:translate-y-[-2px]">
                        <div class="flex items-center justify-between">
                            <i data-lucide="alert-triangle" class="w-8 h-8 text-red-500"></i>
                            <span class="text-xs font-semibold text-red-500 uppercase">Outstanding Fees</span>
                        </div>
                        <p id="kpi-outstanding" class="text-4xl font-extrabold text-red-500 mt-3">$859,000</p>
                        <p class="text-sm text-gray-500 mt-1 flex items-center">
                            <i data-lucide="tag" class="w-4 h-4 text-gray-500 mr-1"></i> 
                            15% of Total Fees
                        </p>
                    </div>

                    <!-- KPI Card 3: Gov't Reimbursement Pending -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-b-4 border-secondary transition duration-300 hover:shadow-xl hover:translate-y-[-2px]">
                        <div class="flex items-center justify-between">
                            <i data-lucide="banknote" class="w-8 h-8 text-secondary"></i>
                            <span class="text-xs font-semibold text-secondary uppercase">Gov't Reimbursement Pending</span>
                        </div>
                        <p id="kpi-govt-pending" class="text-4xl font-extrabold text-gray-900 mt-3">$1,200,000</p>
                        <p class="text-sm text-gray-500 mt-1 flex items-center">
                            <i data-lucide="clock" class="w-4 h-4 text-gray-500 mr-1"></i> 
                            Awaiting 45 days
                        </p>
                    </div>

                    <!-- KPI Card 4: Scholarship Disbursements -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-b-4 border-primary transition duration-300 hover:shadow-xl hover:translate-y-[-2px]">
                        <div class="flex items-center justify-between">
                            <i data-lucide="graduation-cap" class="w-8 h-8 text-primary"></i>
                            <span class="text-xs font-semibold text-primary uppercase">Scholarship Students</span>
                        </div>
                        <p id="kpi-scholarship-count" class="text-4xl font-extrabold text-gray-900 mt-3">780</p>
                        <p class="text-sm text-gray-500 mt-1 flex items-center">
                            <i data-lucide="percent" class="w-4 h-4 text-gray-500 mr-1"></i> 
                            12% of Total Enrollment
                        </p>
                    </div>
                </div>
            </section>

            <!-- 2. Detailed Payment Status View -->
            <div class="grid lg:grid-cols-3 gap-6">
                
                <!-- Col 1 (Payment Status Ratio Chart) -->
                <section class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold mb-4 text-gray-900 flex items-center">
                        <i data-lucide="pie-chart" class="w-5 h-5 text-secondary mr-2"></i>
                        Student Payment Status Ratio
                    </h2>
                    
                    <!-- Chart Placeholder 1 -->
                    <div class="chart-placeholder !h-60 !bg-emerald-50/50 !border-secondary">
                        <p>Mock Pie Chart: Paid vs Unpaid</p>
                    </div>

                    <div class="space-y-2 mt-4 text-sm font-medium">
                        <div class="flex justify-between">
                            <span class="text-secondary flex items-center"><i data-lucide="square" class="w-3 h-3 fill-secondary mr-2"></i> Fully Paid:</span>
                            <span>6,800 Students</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-primary flex items-center"><i data-lucide="square" class="w-3 h-3 fill-primary mr-2"></i> Partial Payment:</span>
                            <span>1,200 Students</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-red-500 flex items-center"><i data-lucide="square" class="w-3 h-3 fill-red-500 mr-2"></i> Outstanding:</span>
                            <span>930 Students</span>
                        </div>
                    </div>
                </section>
                
                <!-- Col 2 (Scholarship & Government Funding Status) -->
                <section class="lg:col-span-2 space-y-6">
                    
                    <!-- Scholarship/Govt Table -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-xl font-bold mb-4 text-gray-900 flex items-center">
                            <i data-lucide="list-checks" class="w-5 h-5 text-primary mr-2"></i>
                            Reimbursement & Funding Status
                        </h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Students</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount Pending</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr class="hover:bg-indigo-50/50 transition duration-150">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Gov't Grant Program A</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">550</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-500 font-medium">$750,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Delayed</span></td>
                                    </tr>
                                    <tr class="hover:bg-indigo-50/50 transition duration-150">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Merit Scholarship Fund</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">230</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">$109,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Processing</span></td>
                                    </tr>
                                    <tr class="hover:bg-indigo-50/50 transition duration-150">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Financial Aid Program B</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">120</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-secondary font-medium">$55,000</td>
                                        <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-secondary">Received</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Actions Card -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-primary">
                        <h2 class="text-xl font-bold mb-4 text-gray-900 flex items-center">
                            <i data-lucide="send" class="w-5 h-5 text-primary mr-2"></i>
                            Quick Actions
                        </h2>
                        <div class="grid grid-cols-2 gap-4">
                            <button class="bg-indigo-100 text-primary py-3 rounded-lg font-semibold hover:bg-primary hover:text-white transition">
                                Send Fee Reminders
                            </button>
                            <button class="bg-emerald-100 text-secondary py-3 rounded-lg font-semibold hover:bg-secondary hover:text-white transition">
                                Generate Financial Report
                            </button>
                        </div>
                    </div>
                </section>
                
            </div>
        </div>

    </div>

    <!-- Pure JavaScript Logic -->
    <script>
        // Constants
        const MOCK_SESSION_KEY = 'campusg_session_mock';
        
        // 1. Initialize Icons and Check Session
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            checkMockSession();
            setupSidebarToggle();
            setupSignoutButtons();
        });

        // --- Mock Data Functions ---
        
        function applyFinanceFilters() {
            const year = document.getElementById('filter-year').value;
            const branch = document.getElementById('filter-branch').value;
            const feeType = document.getElementById('filter-fee-type').value;
            
            console.log(`Applying Filters: Year=${year}, Branch=${branch}, FeeType=${feeType}`);
            
            // --- MOCK DATA CHANGE LOGIC ---
            // Simulating dynamic data update based on filters
            let collected = '$4,850,000';
            let outstanding = '$859,000';
            let govtPending = '$1,200,000';
            let scholarshipCount = '780';
            
            if (branch === 'cs') {
                 collected = '$2,100,000';
                 outstanding = '$150,000';
                 scholarshipCount = '310';
            } else if (branch === 'mba') {
                 collected = '$900,000';
                 outstanding = '$450,000';
                 scholarshipCount = '120';
            }
            
            if (feeType === 'hostel') {
                 collected = '$500,000';
                 outstanding = '$120,000';
            }

            // Update KPIs
            document.getElementById('kpi-collected').textContent = collected;
            document.getElementById('kpi-outstanding').textContent = outstanding;
            document.getElementById('kpi-govt-pending').textContent = govtPending;
            document.getElementById('kpi-scholarship-count').textContent = scholarshipCount;

            // In a real app, the charts and tables would also be redrawn here.
            alert(`Filters applied! Showing financial data for ${branch} on ${feeType}. KPI values have been mocked accordingly.`);
        }


        // --- Session & UI Functions (Reused from Dashboard) ---

        function checkMockSession() {
            const sessionData = localStorage.getItem(MOCK_SESSION_KEY);
            if (!sessionData) {
                console.warn('No active mock session found. Redirecting to login.');
                // window.location.href = 'login.html'; 
                return; 
            }
            try {
                const { is_onboarded } = JSON.parse(sessionData);
                if (!is_onboarded) {
                    console.warn('User logged in but not onboarded. Redirecting to setup.');
                    window.location.href = 'initial_setup.html'; 
                    return;
                }
            } catch (e) {
                console.error('Failed to parse session data:', e);
                clearMockSession();
            }
        }

        function clearMockSession() {
            localStorage.removeItem(MOCK_SESSION_KEY);
            sessionStorage.removeItem(MOCK_SESSION_KEY);
            console.log('Mock session cleared. Redirecting to login.');
            window.location.href = 'login.html';
        }

        function setupSignoutButtons() {
            const signoutHandler = (event) => {
                event.preventDefault();
                clearMockSession();
            };
            document.getElementById('signout-button').addEventListener('click', signoutHandler);
            document.getElementById('profile-signout-button').addEventListener('click', signoutHandler);
        }
        
        function setupSidebarToggle() {
            const sidebar = document.getElementById('sidebar');
            const toggleButton = document.getElementById('mobile-sidebar-toggle');

            toggleButton.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });
            
            document.getElementById('main-content').addEventListener('click', (event) => {
                if (!sidebar.classList.contains('-translate-x-full') && !sidebar.contains(event.target) && !toggleButton.contains(event.target)) {
                    if (window.innerWidth < 1024) { 
                        sidebar.classList.add('-translate-x-full');
                    }
                }
            });
        }
    </script>
</body>
</html>
